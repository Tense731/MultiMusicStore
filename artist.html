<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Artists - MultiMusic</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="artist.css">
  <link rel="stylesheet" href="player.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <h1 class="logo">MultiMusic</h1>

    <!-- Desktop Navigation -->
    <nav class="desktop-nav">
      <a href="index.html">Home</a>
      <a href="browse.html">Browse</a>
      <a href="artist.html" class="active" style="color: #ec4899;">Artists</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>

    <!-- Auth Buttons (desktop only) -->
    <div class="auth-buttons desktop-auth">
       <a href="login.html" class="login-btn">Login</a>
    <a href="signup.html" class="signup-btn">Sign Up</a>
    </div>

    <!-- Hamburger (mobile only) -->
    <button class="hamburger" onclick="toggleMenu()">☰</button>
  </header>

  <nav class="mobile-nav" id="navMenu">
    <a href="index.html">Home</a>
    <a href="browse.html">Browse</a>
    <a href="artist.html" class="active">Artists</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
    <div class="auth-buttons">
        <button class="login-btn"><a href="login.html">Login</a></button>
      <button class="signup-btn"><a href="signup.html">Sign Up</a></button>
    </div>
  </nav>

  <!-- ARTISTS SECTION -->
  <main class="artists-section">
    <h2>Meet Our Artists</h2>
    <p class="section-subtitle">Discover independent musicians from around the world</p>

    <div class="artists-grid" id="artistsContainer">
      <div class="artist-card">
        <h3>Loading...</h3>
      </div>
    </div>
  </main>

  <div class="music-player">
    <div class="player-song-info">
      <img id="player-cover" class="player-cover" src="https://images.pexels.com/photos/1105666/pexels-photo-1105666.jpeg?w=100" alt="Cover">
      <div class="player-text">
        <div id="player-song-title" class="player-song-title">No song playing</div>
        <div id="player-artist-name" class="player-artist-name">Select a song to start</div>
      </div>
    </div>

    <div class="player-controls-center">
      <div class="player-buttons">
        <button id="shuffle-btn" class="player-btn" style="opacity: 0.6;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
            <path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/>
          </svg>
        </button>
        <button id="prev-btn" class="player-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
            <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
          </svg>
        </button>
        <button id="play-btn" class="player-btn play-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </button>
        <button id="next-btn" class="player-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
            <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
          </svg>
        </button>
        <button id="repeat-btn" class="player-btn" style="opacity: 0.6;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
            <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
          </svg>
        </button>
      </div>

      <div class="progress-container">
        <span id="current-time" class="progress-time">0:00</span>
        <div class="progress-bar-container" id="progress-container">
          <div id="progress-bar" class="progress-bar"></div>
        </div>
        <span id="duration" class="progress-time">0:00</span>
      </div>
    </div>

    <div class="player-volume">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
      </svg>
      <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="70">
    </div>
  </div>

  <footer class="footer">
    <p>© 2025 MultiMusic | Stream Unlimited Music</p>
    <div class="socials">
      <a href="#">Facebook</a>
      <a href="#">Twitter</a>
      <a href="#">Instagram</a>
    </div>
  </footer>

  <script type="module">
    import { supabase } from './supabase.js';
    import { player } from './player.js';

    gsap.from(".artists-section h2", {y: 50, opacity: 0, duration: 1});

    window.toggleMenu = function() {
      const navMenu = document.getElementById("navMenu");
      navMenu.classList.toggle("active");
      const burger = document.querySelector(".hamburger");
      burger.textContent = navMenu.classList.contains("active") ? "✖" : "☰";
    };

    async function loadArtists() {
      const { data: artists, error } = await supabase
        .from('artists')
        .select('*')
        .order('followers_count', { ascending: false });

      if (error) {
        console.error('Error loading artists:', error);
        return;
      }

      const container = document.getElementById('artistsContainer');
      container.innerHTML = '';

      artists.forEach(artist => {
        const card = document.createElement('div');
        card.className = 'artist-card';
        card.innerHTML = `
          <img src="${artist.avatar_url || 'https://images.pexels.com/photos/3785079/pexels-photo-3785079.jpeg?w=300'}"
               alt="${artist.name}" class="artist-img"
               style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin-bottom: 15px;">
          <h3 style="font-size: 1.2rem; margin-bottom: 5px; color: white;">${artist.name}</h3>
          <p style="color: #ec4899; font-size: 0.9rem; margin-bottom: 8px;">${artist.genre || 'Unknown'}</p>
          <p style="color: #aaa; font-size: 0.85rem; margin-bottom: 12px; height: 40px; overflow: hidden;">
            ${artist.bio ? artist.bio.substring(0, 60) + '...' : 'No bio available'}
          </p>
          <button class="browse-btn" style="padding: 8px 20px; border: none; border-radius: 20px;
            background: #ec4899; color: white; font-weight: bold; cursor: pointer;">View Songs</button>
        `;

        card.querySelector('.browse-btn').onclick = async () => {
          await loadArtistSongs(artist.id, artist.name);
        };

        container.appendChild(card);
      });

      gsap.from(".artist-card", {scale: 0.8, opacity: 0, duration: 1, stagger: 0.2, delay: 0.3});
    }

    async function loadArtistSongs(artistId, artistName) {
      const { data: songs, error } = await supabase
        .from('songs')
        .select('*')
        .eq('artist_id', artistId);

      if (error) {
        console.error('Error loading artist songs:', error);
        return;
      }

      if (songs.length === 0) {
        alert('No songs available for this artist yet.');
        return;
      }

      const songsWithArtist = songs.map(s => ({ ...s, artist_name: artistName }));
      player.setQueue(songsWithArtist, 0);
      player.play();
    }

    document.getElementById('play-btn').onclick = () => player.togglePlay();
    document.getElementById('next-btn').onclick = () => player.playNext();
    document.getElementById('prev-btn').onclick = () => player.playPrevious();
    document.getElementById('repeat-btn').onclick = () => player.toggleRepeat();
    document.getElementById('shuffle-btn').onclick = () => player.toggleShuffle();

    document.getElementById('volume-slider').oninput = (e) => {
      player.setVolume(e.target.value / 100);
    };

    document.getElementById('progress-container').onclick = (e) => {
      const rect = e.currentTarget.getBoundingClientRect();
      const percent = (e.clientX - rect.left) / rect.width;
      player.seek(percent * player.audio.duration);
    };

    loadArtists();
  </script>
</body>
</html>
